<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWASP Cebu - ASVS v5.0 Workshop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
        }

        .presentation {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .slide {
            background: white;
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 60px;
            display: none;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }

        .slide.active {
            display: flex;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-header {
            margin-bottom: 40px;
        }

        h1 {
            color: #667eea;
            font-size: 3em;
            margin-bottom: 20px;
        }

        h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }

        h3 {
            color: #764ba2;
            font-size: 1.8em;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        h4 {
            color: #555;
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p, li {
            color: #333;
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        ul {
            margin-left: 40px;
            margin-bottom: 20px;
        }

        .subtitle {
            color: #666;
            font-size: 1.5em;
            font-style: italic;
        }

        .user-story {
            background: #f0f4ff;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
            font-style: italic;
            font-size: 1.3em;
        }

        .vulnerability-box {
            background: #ffebee;
            border-left: 5px solid #e53935;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .secure-box {
            background: #e8f5e9;
            border-left: 5px solid #43a047;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .asvs-mapping {
            background: #fff3e0;
            border: 2px solid #ff9800;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
        }

        .asvs-mapping h4 {
            color: #e65100;
            margin-top: 0;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre;
            line-height: 1.5;
        }

        .comment {
            color: #6a9955;
        }

        .keyword {
            color: #569cd6;
        }

        .string {
            color: #ce9178;
        }

        .controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .slide-number {
            position: fixed;
            bottom: 30px;
            left: 30px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .badge-danger {
            background: #e53935;
        }

        .badge-success {
            background: #43a047;
        }

        .badge-warning {
            background: #ff9800;
        }

        .highlight-box {
            background: #fffbea;
            border: 3px dashed #ffc107;
            padding: 30px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: center;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li:before {
            content: "✓ ";
            color: #43a047;
            font-weight: bold;
            font-size: 1.4em;
            margin-right: 10px;
        }

        .timeline {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .timeline-time {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            min-width: 80px;
            text-align: center;
            font-weight: bold;
            margin-right: 20px;
        }

        .key-point {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.3em;
            text-align: center;
            font-weight: bold;
        }

        .emoji {
            font-size: 2em;
            margin-right: 15px;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .comparison-bad {
            background: #ffebee;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #e53935;
        }

        .comparison-good {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #43a047;
        }

        .comparison h4 {
            margin-top: 0;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #999;
            font-size: 0.9em;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="presentation">
        <!-- Slide 1: Title -->
        <div class="slide active">
            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center;">
                <h1 style="font-size: 4em; margin-bottom: 30px;">🔒 OWASP ASVS v5.0</h1>
                <p class="subtitle" style="font-size: 2em; margin-bottom: 50px;">Application Security Verification Standard</p>
                <p style="font-size: 1.5em; color: #666;">Building Secure Applications from User Stories</p>
                <p style="font-size: 1.2em; color: #999; margin-top: 80px;">Interactive Workshop • 60 Minutes</p>
            </div>
        </div>

        <!-- Slide 2: Agenda -->
        <div class="slide">
            <h2>Workshop Agenda</h2>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-time">5 min</div>
                    <div>Introduction to OWASP ASVS v5.0</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-time">15 min</div>
                    <div><strong>Scenario 1:</strong> User Authentication & Login</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-time">15 min</div>
                    <div><strong>Scenario 2:</strong> API Security & Access Control</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-time">15 min</div>
                    <div><strong>Scenario 3:</strong> File Upload Security</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-time">10 min</div>
                    <div>Interactive Exercise & Q&A</div>
                </div>
            </div>
            <div class="key-point" style="margin-top: 40px;">
                <span class="emoji">🎯</span>
                Goal: Map security requirements to user stories using ASVS
            </div>
        </div>

        <!-- Slide 3: What is OWASP ASVS? -->
        <div class="slide">
            <h2>What is OWASP ASVS?</h2>
            <p style="font-size: 1.4em; margin-bottom: 30px;">A comprehensive checklist and framework for <strong>defining security requirements</strong> for web applications.</p>
            
            <div class="grid-2" style="margin-top: 40px;">
                <div class="card">
                    <h3 style="margin-top: 0;">📋 What it provides</h3>
                    <ul>
                        <li>Security requirements catalog</li>
                        <li>Three verification levels</li>
                        <li>Testable security controls</li>
                        <li>Industry standard framework</li>
                    </ul>
                </div>
                <div class="card">
                    <h3 style="margin-top: 0;">✅ Why use it?</h3>
                    <ul>
                        <li>Build security from the start</li>
                        <li>Reduce vulnerabilities</li>
                        <li>Meet compliance requirements</li>
                        <li>Establish security baseline</li>
                    </ul>
                </div>
            </div>

            <div class="highlight-box" style="margin-top: 40px;">
                <strong style="font-size: 1.4em;">Version 5.0 is the latest release with major restructuring and updated requirements for modern applications</strong>
            </div>
        </div>

        <!-- Slide 4: Key ASVS Chapters -->
        <div class="slide">
            <h2>Key ASVS v5.0 Chapters</h2>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px;">
                <div class="card">
                    <span class="badge">V6</span>
                    <strong>Authentication</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Login, passwords, MFA</p>
                </div>
                <div class="card">
                    <span class="badge">V7</span>
                    <strong>Session Management</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Session tokens, cookies, logout</p>
                </div>
                <div class="card">
                    <span class="badge">V8</span>
                    <strong>Authorization</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Access control, IDOR prevention</p>
                </div>
                <div class="card">
                    <span class="badge">V2</span>
                    <strong>Validation & Business Logic</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Input validation, sanitization</p>
                </div>
                <div class="card">
                    <span class="badge">V11</span>
                    <strong>Cryptography</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Password hashing, encryption</p>
                </div>
                <div class="card">
                    <span class="badge">V16</span>
                    <strong>Logging & Error Handling</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Secure logging, error messages</p>
                </div>
                <div class="card">
                    <span class="badge">V14</span>
                    <strong>Data Protection</strong>
                    <p style="font-size: 1em; margin-top: 10px;">Sensitive data handling, PII</p>
                </div>
                <div class="card">
                    <span class="badge">V5</span>
                    <strong>File Handling</strong>
                    <p style="font-size: 1em; margin-top: 10px;">File uploads, downloads</p>
                </div>
            </div>
        </div>

        <!-- Slide 5: Scenario 1 - User Story -->
        <div class="slide">
            <h2>Scenario 1: User Login Feature</h2>
            <div class="user-story">
                "As a user, I want to log into the application using my email and password so that I can access my account."
            </div>
            
            <h3 style="margin-top: 40px;">🤔 Discussion Question:</h3>
            <div class="highlight-box">
                <p style="font-size: 1.5em; margin: 0;">What could go wrong with a login feature?<br>What security concerns should we address?</p>
            </div>

            <div style="margin-top: 40px;">
                <h4>Common Concerns:</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    <span class="badge badge-danger">Weak Passwords</span>
                    <span class="badge badge-danger">Brute Force Attacks</span>
                    <span class="badge badge-danger">Credential Stuffing</span>
                    <span class="badge badge-danger">Insecure Storage</span>
                    <span class="badge badge-danger">Session Hijacking</span>
                </div>
            </div>
        </div>

        <!-- Slide 6: Scenario 1 - ASVS Mapping -->
        <div class="slide">
            <h2>Scenario 1: ASVS v5.0 Mapping</h2>
            
            <div class="asvs-mapping">
                <h4>V6: Authentication</h4>
                <ul>
                    <li><strong>V6.2.1</strong> - Password length (minimum 8, recommend 15+ characters)</li>
                    <li><strong>V6.2.5</strong> - Passwords of any composition can be used (no character restrictions)</li>
                    <li><strong>V6.3.1</strong> - Controls to prevent credential stuffing and brute force attacks</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V11: Cryptography</h4>
                <ul>
                    <li><strong>V11.4.2</strong> - Passwords stored using approved key derivation functions (Argon2id, scrypt, bcrypt, PBKDF2)</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V7: Session Management</h4>
                <ul>
                    <li><strong>V7.2.4</strong> - Generate new session token after authentication</li>
                    <li><strong>V7.3.1</strong> - Inactivity timeout with re-authentication</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V2: Validation</h4>
                <ul>
                    <li><strong>V2.2.1</strong> - Input validation at trusted service layer</li>
                </ul>
            </div>
        </div>

        <!-- Slide 7: Scenario 1 - Bad Code -->
        <div class="slide">
            <h2>❌ Bad Code: Vulnerable Login</h2>
            <div class="code-block"><span class="comment"># Python/Flask Example - INSECURE</span>
<span class="keyword">@app</span>.route(<span class="string">'/login'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> login():
    email = request.form[<span class="string">'email'</span>]
    password = request.form[<span class="string">'password'</span>]
    
    <span class="comment"># VULNERABILITY 1: Using weak hashing (MD5)</span>
    password_hash = hashlib.md5(password.encode()).hexdigest()
    
    <span class="comment"># VULNERABILITY 2: SQL Injection vulnerability</span>
    user = db.query(<span class="string">f"SELECT * FROM users WHERE email='{email}'"</span>)
    
    <span class="keyword">if</span> user:
        <span class="comment"># VULNERABILITY 3: No session regeneration</span>
        session[<span class="string">'user_id'</span>] = user.id
        <span class="keyword">return</span> <span class="string">"Login successful"</span></div>

            <div class="vulnerability-box" style="margin-top: 20px;">
                <strong style="color: #c62828;">🚨 Critical Issues:</strong>
                <ul style="margin-top: 15px;">
                    <li>Weak MD5 hashing - easily cracked</li>
                    <li>No rate limiting - brute force vulnerable</li>
                    <li>SQL injection risk</li>
                    <li>Session fixation vulnerability</li>
                </ul>
            </div>
        </div>

        <!-- Slide 8: Scenario 1 - Good Code -->
        <div class="slide">
            <h2>✅ Good Code: Secure Login</h2>
            <div class="code-block" style="max-height: 350px;"><span class="keyword">from</span> flask_limiter <span class="keyword">import</span> Limiter
<span class="keyword">import</span> bcrypt

<span class="comment"># V6.3.1: Rate limiting to prevent brute force</span>
limiter = Limiter(app, default_limits=[<span class="string">"200 per day"</span>])

<span class="keyword">@app</span>.route(<span class="string">'/login'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">@limiter</span>.limit(<span class="string">"5 per minute"</span>)
<span class="keyword">def</span> login():
    email = request.form[<span class="string">'email'</span>].strip()
    password = request.form[<span class="string">'password'</span>]
    
    <span class="comment"># V6.2.1: Password length validation</span>
    <span class="keyword">if</span> len(password) < 8 or len(password) > 128:
        <span class="keyword">return</span> {<span class="string">"error"</span>: <span class="string">"Invalid credentials"</span>}, 401
    
    <span class="comment"># V2.2.1: Parameterized queries prevent SQL injection</span>
    query = text(<span class="string">"SELECT * FROM users WHERE email = :email"</span>)
    user = db.execute(query, {<span class="string">"email"</span>: email})
    
    <span class="comment"># V11.4.2: Verify password with bcrypt</span>
    <span class="keyword">if</span> user and bcrypt.checkpw(password.encode(), user.password_hash):
        <span class="comment"># V7.2.4: Regenerate session after authentication</span>
        session.regenerate()
        session[<span class="string">'user_id'</span>] = user.id
        <span class="keyword">return</span> {<span class="string">"success"</span>: True}</div>

            <div class="secure-box" style="margin-top: 20px;">
                <strong style="color: #2e7d32;">✓ Security Controls Implemented:</strong>
                <ul style="margin-top: 15px;">
                    <li>Bcrypt password hashing (V11.4.2)</li>
                    <li>Rate limiting prevents brute force (V6.3.1)</li>
                    <li>Parameterized queries (V2.2.1)</li>
                    <li>Session regeneration (V7.2.4)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 9: Scenario 2 - User Story -->
        <div class="slide">
            <h2>Scenario 2: User Profile API</h2>
            <div class="user-story">
                "As an authenticated user, I want to retrieve my profile information via API so that I can display it in the mobile app."
            </div>
            
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 30px 0; font-family: monospace;">
                <strong>API Endpoint:</strong> GET /api/users/{userId}/profile
            </div>

            <h3 style="margin-top: 30px;">🤔 Discussion Question:</h3>
            <div class="highlight-box">
                <p style="font-size: 1.5em; margin: 0;">What security risks exist when exposing user data through an API?</p>
            </div>

            <div style="margin-top: 30px;">
                <h4>Common Risks:</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    <span class="badge badge-danger">Unauthorized Access</span>
                    <span class="badge badge-danger">IDOR Vulnerabilities</span>
                    <span class="badge badge-danger">Data Over-exposure</span>
                    <span class="badge badge-danger">Missing Authorization</span>
                </div>
            </div>
        </div>

        <!-- Slide 10: Scenario 2 - ASVS Mapping -->
        <div class="slide">
            <h2>Scenario 2: ASVS v5.0 Mapping</h2>
            
            <div class="asvs-mapping">
                <h4>V8: Authorization</h4>
                <ul>
                    <li><strong>V8.2.1</strong> - Function-level access restricted to consumers with explicit permissions</li>
                    <li><strong>V8.2.2</strong> - Data-specific access restricted to prevent IDOR and BOLA</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V4: API and Web Service</h4>
                <ul>
                    <li><strong>V4.1.1</strong> - Proper Content-Type headers in HTTP responses</li>
                    <li><strong>V4.1.2</strong> - User-facing endpoints redirect HTTP to HTTPS appropriately</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V14: Data Protection</h4>
                <ul>
                    <li><strong>V14.2.1</strong> - Sensitive data only in HTTP body or headers, not in URL</li>
                    <li><strong>V14.3.2</strong> - Anti-caching headers for sensitive data</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V2: Validation</h4>
                <ul>
                    <li><strong>V2.2.2</strong> - Input validation at trusted service layer</li>
                </ul>
            </div>
        </div>

        <!-- Slide 11: Scenario 2 - Bad Code -->
        <div class="slide">
            <h2>❌ Bad Code: Vulnerable API</h2>
            <div class="code-block"><span class="comment"># Python/Flask API - INSECURE</span>
<span class="keyword">@app</span>.route(<span class="string">'/api/users/&lt;user_id&gt;/profile'</span>)
<span class="keyword">def</span> get_profile(user_id):
    <span class="comment"># VULNERABILITY 1: No authentication check</span>
    <span class="comment"># VULNERABILITY 2: No authorization check (IDOR)</span>
    
    user = db.query(User).filter_by(id=user_id).first()
    
    <span class="keyword">if</span> user:
        <span class="comment"># VULNERABILITY 3: Exposing sensitive data</span>
        <span class="keyword">return</span> jsonify({
            <span class="string">'id'</span>: user.id,
            <span class="string">'email'</span>: user.email,
            <span class="string">'ssn'</span>: user.ssn,  <span class="comment"># Should NEVER be exposed!</span>
            <span class="string">'password_hash'</span>: user.password_hash,  <span class="comment"># Never expose!</span>
            <span class="string">'salary'</span>: user.salary,
            <span class="string">'credit_card'</span>: user.credit_card
        })</div>

            <div class="vulnerability-box" style="margin-top: 20px;">
                <strong style="color: #c62828;">🚨 Critical Issues:</strong>
                <ul style="margin-top: 15px;">
                    <li><strong>IDOR (V8.2.2):</strong> Any user can access any profile</li>
                    <li><strong>Data Exposure (V14.2.1):</strong> Sensitive fields exposed</li>
                    <li><strong>No Authentication:</strong> Endpoint accessible without login</li>
                </ul>
            </div>
        </div>

        <!-- Slide 12: Scenario 2 - Good Code -->
        <div class="slide">
            <h2>✅ Good Code: Secure API</h2>
            <div class="code-block" style="max-height: 350px;"><span class="comment"># V6: Authentication middleware</span>
<span class="keyword">def</span> require_auth(f):
    <span class="keyword">def</span> decorated(*args, **kwargs):
        token = request.headers.get(<span class="string">'Authorization'</span>)
        <span class="keyword">if</span> not token:
            <span class="keyword">return</span> jsonify({<span class="string">'error'</span>: <span class="string">'Unauthorized'</span>}), 401
        g.current_user_id = verify_token(token)
        <span class="keyword">return</span> f(*args, **kwargs)
    <span class="keyword">return</span> decorated

<span class="keyword">@app</span>.route(<span class="string">'/api/users/&lt;int:user_id&gt;/profile'</span>)
<span class="keyword">@require_auth</span>
<span class="keyword">def</span> get_profile(user_id):
    <span class="comment"># V8.2.2: Authorization - users can only access their own data</span>
    <span class="keyword">if</span> g.current_user_id != user_id:
        logger.warning(<span class="string">f"IDOR attempt by {g.current_user_id}"</span>)
        <span class="keyword">return</span> jsonify({<span class="string">'error'</span>: <span class="string">'Forbidden'</span>}), 403
    
    user = db.query(User).filter_by(id=user_id).first()
    
    <span class="comment"># V14.2.1: Return only non-sensitive data</span>
    response = jsonify({
        <span class="string">'id'</span>: user.id,
        <span class="string">'email'</span>: user.email,
        <span class="string">'full_name'</span>: user.full_name
        <span class="comment"># No SSN, password_hash, credit_card!</span>
    })
    
    <span class="comment"># V14.3.2: Prevent caching of sensitive data</span>
    response.headers[<span class="string">'Cache-Control'</span>] = <span class="string">'no-store'</span>
    <span class="keyword">return</span> response</div>

            <div class="secure-box" style="margin-top: 20px;">
                <strong style="color: #2e7d32;">✓ Security Controls Implemented:</strong>
                <ul style="margin-top: 15px; font-size: 1em;">
                    <li>Authentication required</li>
                    <li>Authorization enforced (V8.2.2)</li>
                    <li>Minimal data exposure (V14.2.1)</li>
                    <li>No caching (V14.3.2)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 13: Scenario 3 - User Story -->
        <div class="slide">
            <h2>Scenario 3: File Upload Feature</h2>
            <div class="user-story">
                "As a user, I want to upload my profile picture so that other users can see my photo."
            </div>
            
            <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 30px 0; font-family: monospace;">
                <strong>API Endpoint:</strong> POST /api/users/profile-picture
            </div>

            <h3 style="margin-top: 30px;">🤔 Discussion Question:</h3>
            <div class="highlight-box">
                <p style="font-size: 1.5em; margin: 0;">What can go wrong when users upload files?</p>
            </div>

            <div style="margin-top: 30px;">
                <h4>Common Risks:</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    <span class="badge badge-danger">Malicious Files</span>
                    <span class="badge badge-danger">Path Traversal</span>
                    <span class="badge badge-danger">XSS via Files</span>
                    <span class="badge badge-danger">Storage Exhaustion</span>
                    <span class="badge badge-danger">Remote Code Execution</span>
                </div>
            </div>
        </div>

        <!-- Slide 14: Scenario 3 - ASVS Mapping -->
        <div class="slide">
            <h2>Scenario 3: ASVS v5.0 Mapping</h2>
            
            <div class="asvs-mapping">
                <h4>V5: File Handling</h4>
                <ul>
                    <li><strong>V5.4.1</strong> - Validate or ignore user-submitted filenames</li>
                    <li><strong>V5.3.2</strong> - Use internally generated filenames to prevent path traversal</li>
                    <li><strong>V5.2.1</strong> - File size limits to prevent DoS</li>
                    <li><strong>V5.4.2</strong> - Filenames encoded/sanitized when serving</li>
                    <li><strong>V5.1.1</strong> - Document permitted file types and maximum sizes</li>
                    <li><strong>V5.3.3</strong> - Server-side processing ignores user-provided paths</li>
                </ul>
            </div>

            <div class="asvs-mapping">
                <h4>V2: Validation</h4>
                <ul>
                    <li><strong>V2.2.1</strong> - Input validation for file metadata</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: Scenario 3 - Bad Code -->
        <div class="slide">
            <h2>❌ Bad Code: Vulnerable Upload</h2>
            <div class="code-block"><span class="comment"># Python/Flask - INSECURE</span>
<span class="keyword">@app</span>.route(<span class="string">'/api/users/profile-picture'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> upload_profile_picture():
    <span class="comment"># VULNERABILITY 1: No file validation</span>
    file = request.files[<span class="string">'profile_picture'</span>]
    
    <span class="comment"># VULNERABILITY 2: Using user filename (path traversal!)</span>
    filename = file.filename
    
    <span class="comment"># VULNERABILITY 3: No file size limit</span>
    <span class="comment"># VULNERABILITY 4: Storing in web-accessible directory</span>
    upload_path = os.path.join(<span class="string">'/var/www/html/uploads'</span>, filename)
    file.save(upload_path)
    
    <span class="comment"># VULNERABILITY 5: Returning direct file path</span>
    <span class="keyword">return</span> jsonify({
        <span class="string">'file_url'</span>: <span class="string">f'/uploads/{filename}'</span>
    })</div>

            <div class="vulnerability-box" style="margin-top: 20px;">
                <strong style="color: #c62828;">🚨 Critical Issues:</strong>
                <ul style="margin-top: 15px;">
                    <li><strong>Path Traversal (V5.3.2):</strong> Can upload to <code>../../etc/passwd</code></li>
                    <li><strong>No Validation (V5.4.1):</strong> Can upload .php, .exe, malicious files</li>
                    <li><strong>DoS Risk (V5.2.1):</strong> No size limits</li>
                </ul>
            </div>
        </div>

        <!-- Slide 16: Scenario 3 - Good Code Part 1 -->
        <div class="slide">
            <h2>✅ Good Code: Secure Upload (Part 1)</h2>
            <div class="code-block" style="max-height: 400px;"><span class="keyword">import</span> uuid, magic
<span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename

<span class="comment"># V5.2.1: Maximum file size</span>
MAX_FILE_SIZE = 5 * 1024 * 1024

<span class="comment"># V5.4.1: Allowed MIME types</span>
ALLOWED_MIME_TYPES = [<span class="string">'image/jpeg'</span>, <span class="string">'image/png'</span>, <span class="string">'image/gif'</span>]

<span class="keyword">@app</span>.route(<span class="string">'/api/users/profile-picture'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">@require_auth</span>
<span class="keyword">def</span> upload_profile_picture():
    file = request.files[<span class="string">'profile_picture'</span>]
    
    <span class="comment"># V5.2.1: Check file size</span>
    file.seek(0, os.SEEK_END)
    file_size = file.tell()
    <span class="keyword">if</span> file_size > MAX_FILE_SIZE:
        <span class="keyword">return</span> jsonify({<span class="string">'error'</span>: <span class="string">'File too large'</span>}), 400
    
    file.seek(0)
    file_content = file.read()
    
    <span class="comment"># V5.4.1: Validate using magic numbers (not extension!)</span>
    mime = magic.Magic(mime=True)
    detected_mime = mime.from_buffer(file_content)
    
    <span class="keyword">if</span> detected_mime not in ALLOWED_MIME_TYPES:
        <span class="keyword">return</span> jsonify({<span class="string">'error'</span>: <span class="string">'Invalid file type'</span>}), 400</div>
            <div class="scroll-indicator">Scroll or see next slide for more →</div>
        </div>

        <!-- Slide 17: Scenario 3 - Good Code Part 2 -->
        <div class="slide">
            <h2>✅ Good Code: Secure Upload (Part 2)</h2>
            <div class="code-block" style="max-height: 400px;">    <span class="comment"># V5.3.2: Generate unique filename (don't use original)</span>
    file_extension = os.path.splitext(secure_filename(file.filename))[1]
    unique_filename = <span class="string">f"{uuid.uuid4()}{file_extension}"</span>
    
    <span class="comment"># V5.3.2: Store outside web root (not web-accessible)</span>
    upload_dir = <span class="string">'/var/app/uploads'</span>  <span class="comment"># Not in /var/www/html!</span>
    file_path = os.path.join(upload_dir, unique_filename)
    
    <span class="comment"># V5.3.2: Prevent path traversal</span>
    <span class="keyword">if</span> not os.path.abspath(file_path).startswith(upload_dir):
        <span class="keyword">return</span> jsonify({<span class="string">'error'</span>: <span class="string">'Invalid path'</span>}), 400
    
    <span class="keyword">with</span> open(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:
        f.write(file_content)
    
    <span class="comment"># V5.4.2: In production, scan for malware</span>
    <span class="comment"># scan_for_malware(file_path)</span>
    
    <span class="comment"># Store reference in database</span>
    db.execute(<span class="string">"UPDATE users SET profile_picture = :file"</span>, 
               {<span class="string">"file"</span>: unique_filename})
    
    <span class="comment"># V5.4.1: Return reference, not direct path</span>
    <span class="keyword">return</span> jsonify({<span class="string">'file_id'</span>: unique_filename})</div>

            <div class="secure-box" style="margin-top: 20px;">
                <strong style="color: #2e7d32;">✓ Security Controls Implemented:</strong>
                <ul style="margin-top: 15px; font-size: 1em;">
                    <li>Magic number validation (V5.4.1)</li>
                    <li>Size limits (V5.2.1)</li>
                    <li>Unique filenames (V5.3.2)</li>
                    <li>Files stored outside web root</li>
                    <li>Path traversal prevention (V5.3.3)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 18: Interactive Exercise -->
        <div class="slide">
            <h2>🎯 Interactive Exercise</h2>
            <div class="highlight-box" style="margin-top: 30px;">
                <h3 style="margin: 0; color: #333;">ASVS Scavenger Hunt</h3>
            </div>

            <div style="background: #f0f4ff; padding: 30px; border-radius: 10px; margin: 30px 0; border-left: 5px solid #667eea;">
                <h4 style="margin-top: 0;">Scenario:</h4>
                <p style="font-size: 1.3em; margin: 0;">
                    "Your team is building a <strong>password reset feature</strong>. Users receive a reset link via email."
                </p>
            </div>

            <div style="background: #fff9e6; padding: 25px; border-radius: 10px; border: 2px dashed #ffc107;">
                <h4 style="margin-top: 0; color: #f57c00;">🔍 Your Task:</h4>
                <p style="font-size: 1.2em; margin-bottom: 20px;">Navigate the ASVS v5.0 documentation and find relevant security requirements for this feature.</p>
                <p style="font-size: 1.1em; margin: 0;"><strong>Time:</strong> 5 minutes</p>
            </div>
        </div>

        <!-- Slide 19: Exercise Solution -->
        <div class="slide">
            <h2>Exercise Solution</h2>
            <h3 style="color: #43a047;">Password Reset Requirements</h3>
            
            <div class="asvs-mapping">
                <h4>Key ASVS v5.0 Requirements Found:</h4>
                <ul>
                    <li><strong>V6.4.3</strong> - Secure password reset process that doesn't bypass MFA</li>
                    <li><strong>V6.2.3</strong> - Password change requires current password</li>
                    <li><strong>V7.2.4</strong> - Token regeneration after password reset</li>
                    <li><strong>V16.1.1</strong> - Log security-relevant events (password reset requests)</li>
                    <li><strong>V12.2.1</strong> - Use TLS for sensitive operations like password reset</li>
                    <li><strong>V6.4.4</strong> - Evidence of identity proofing when MFA factor is lost</li>
                </ul>
            </div>

            <div class="key-point" style="margin-top: 30px;">
                Real-world Impact: These requirements prevent account takeover attacks!
            </div>
        </div>

        <!-- Slide 20: Key Takeaways -->
        <div class="slide">
            <h2>🎓 Key Takeaways</h2>
            
            <div class="card" style="margin: 30px 0; padding: 30px;">
                <h3 style="margin-top: 0; color: #667eea;">Security Requirements Process</h3>
                <ol style="font-size: 1.2em; line-height: 2.5; margin-left: 25px;">
                    <li style="margin-bottom: 15px;"><strong>Start with User Stories</strong> - Understand the feature</li>
                    <li style="margin-bottom: 15px;"><strong>Identify Threats</strong> - What can go wrong?</li>
                    <li style="margin-bottom: 15px;"><strong>Map to ASVS v5.0</strong> - Find relevant requirements</li>
                    <li style="margin-bottom: 15px;"><strong>Implement Controls</strong> - Write secure code</li>
                    <li style="margin-bottom: 15px;"><strong>Test & Verify</strong> - Ensure controls work</li>
                </ol>
            </div>

            <div class="comparison" style="margin-top: 30px;">
                <div class="comparison-bad">
                    <h4 style="color: #c62828;">❌ Without ASVS</h4>
                    <ul style="font-size: 1em;">
                        <li>Ad-hoc security decisions</li>
                        <li>Inconsistent controls</li>
                        <li>Missing requirements</li>
                        <li>Reactive security</li>
                    </ul>
                </div>
                <div class="comparison-good">
                    <h4 style="color: #2e7d32;">✅ With ASVS</h4>
                    <ul style="font-size: 1em;">
                        <li>Systematic approach</li>
                        <li>Comprehensive coverage</li>
                        <li>Industry standards</li>
                        <li>Proactive security</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 21: Security Checklist -->
        <div class="slide">
            <h2>📋 Security Checklist for New Features</h2>
            
            <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 40px; border-radius: 15px; margin-top: 30px;">
                <ul class="checklist" style="font-size: 1.2em;">
                    <li>Is authentication required? → Check <strong>V6</strong></li>
                    <li>Can users access others' data? → Check <strong>V8.2.2</strong> (IDOR)</li>
                    <li>Does it accept user input? → Check <strong>V2</strong> (validation)</li>
                    <li>Does it store passwords? → Check <strong>V11.4.2</strong> (bcrypt/Argon2id)</li>
                    <li>Does it handle files? → Check <strong>V5</strong> (validation, storage)</li>
                    <li>Is it an API endpoint? → Check <strong>V4</strong> and <strong>V8</strong></li>
                    <li>Could it fail? → Check <strong>V16</strong> (logging, errors)</li>
                    <li>Does it expose data? → Check <strong>V14</strong> (minimize exposure)</li>
                </ul>
            </div>

            <div class="key-point" style="margin-top: 40px;">
                <span class="emoji">💡</span>
                Make this checklist part of your Definition of Done!
            </div>
        </div>

        <!-- Slide 22: Common Vulnerabilities Mapped -->
        <div class="slide">
            <h2>OWASP Top 10 ↔️ ASVS v5.0</h2>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 30px;">
                <div class="card">
                    <strong style="color: #e53935;">A01: Broken Access Control</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V8 (Authorization)</p>
                </div>
                <div class="card">
                    <strong style="color: #e53935;">A02: Cryptographic Failures</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V11 (Cryptography), V14 (Data Protection)</p>
                </div>
                <div class="card">
                    <strong style="color: #e53935;">A03: Injection</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V2 (Validation), V1 (Encoding & Sanitization)</p>
                </div>
                <div class="card">
                    <strong style="color: #e53935;">A05: Security Misconfiguration</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V16 (Logging), V13 (Configuration)</p>
                </div>
                <div class="card">
                    <strong style="color: #e53935;">A07: Authentication Failures</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V6 (Authentication), V7 (Session Management)</p>
                </div>
                <div class="card">
                    <strong style="color: #e53935;">A08: Software & Data Integrity</strong>
                    <p style="margin: 10px 0 0 0; font-size: 1em;">→ ASVS V5 (File Handling), V15 (Secure Coding)</p>
                </div>
            </div>
        </div>

        <!-- Slide 23: Resources -->
        <div class="slide">
            <h2>📚 Resources & Next Steps</h2>
            
            <div class="card" style="margin: 30px 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h3 style="margin-top: 0; color: white;">Essential Resources</h3>
                <ul style="font-size: 1.2em; line-height: 2;">
                    <li><strong>OWASP ASVS v5.0:</strong><br>owasp.org/www-project-application-security-verification-standard/</li>
                    <li><strong>OWASP Cheat Sheet Series:</strong><br>cheatsheetseries.owasp.org</li>
                    <li><strong>OWASP Top 10:</strong><br>owasp.org/www-project-top-ten/</li>
                </ul>
            </div>

            <div class="grid-2" style="margin-top: 30px;">
                <div class="card">
                    <h4 style="margin-top: 0;">🛠️ Tools</h4>
                    <ul style="font-size: 1em;">
                        <li>SAST/DAST scanners</li>
                        <li>Dependency checkers</li>
                        <li>Security linters</li>
                    </ul>
                </div>
                <div class="card">
                    <h4 style="margin-top: 0;">📖 Learning</h4>
                    <ul style="font-size: 1em;">
                        <li>OWASP WebGoat</li>
                        <li>Security training</li>
                        <li>Code review practices</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 24: Thank You -->
        <div class="slide">
            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center;">
                <h1 style="font-size: 4em; margin-bottom: 30px;">Thank You! 🎉</h1>
                <p style="font-size: 2em; color: #666; margin-bottom: 60px;">Questions & Discussion</p>
                
                <div style="background: #f0f4ff; padding: 40px; border-radius: 20px; max-width: 800px;">
                    <h3 style="color: #667eea; margin-bottom: 25px;">Remember:</h3>
                    <p style="font-size: 1.4em; line-height: 1.8; color: #333;">
                        Security is not a feature you add at the end.<br>
                        It's a requirement you build from the start.
                    </p>
                </div>

                <p style="font-size: 1.2em; color: #999; margin-top: 60px;">
                    🔐 Build secure. Build with ASVS v5.0. 🔐
                </p>
            </div>
        </div>
    </div>

    <div class="slide-number" id="slideNumber">1 / 24</div>

    <div class="controls">
        <button class="btn" id="prevBtn" onclick="changeSlide(-1)">← Previous</button>
        <button class="btn" id="nextBtn" onclick="changeSlide(1)">Next →</button>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;

        function showSlide(n) {
            slides[currentSlide].classList.remove('active');
            currentSlide = (n + totalSlides) % totalSlides;
            slides[currentSlide].classList.add('active');
            
            document.getElementById('slideNumber').textContent = `${currentSlide + 1} / ${totalSlides}`;
            
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides - 1;
        }

        function changeSlide(direction) {
            showSlide(currentSlide + direction);
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && currentSlide > 0) {
                changeSlide(-1);
            } else if (e.key === 'ArrowRight' && currentSlide < totalSlides - 1) {
                changeSlide(1);
            }
        });

        // Initialize
        showSlide(0);
    </script>
</body>
</html>